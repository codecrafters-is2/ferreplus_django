{% extends "_base_wildcard_bootstrap.html" %}
{% load static %}

{% block title %}Ferreplus{% endblock title %}

{% block custom_styles %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'styles/home/adminpanel.css' %}">
    <link rel="stylesheet" href="{% static 'styles/contact_info/contact_info.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock custom_styles %}
{% block content %}
<div style="width: 90%;">
    <h1 style="margin-bottom:25px; margin-top:25px; font-family: 'Raleway'; ">Análisis de Trueques</h1>
    <div>
        <div class="card" style="width: 100%;">
            <div class="card-body">
                <h3>Cantidad de trueques finalizados por mes y por sucursal: </h3>
                <form method="post" action="{% url 'barter_chart' %}">
                    {% csrf_token %}
                    <label for="year">Ingresa un año:</label>
                    <input type="number" id="year" name="year" min="2000" max="2024" value="{{ selected_year|default_if_none:'' }}">
                    <button type="submit" style="border">Generar Gráficos</button>
                </form>
                {% if chart_1.labels and chart_1.data %}
                <div style="display:flex">
                    <div class="card" style="width:80%; background:#F9FAFB;">
                        <div class="card-body" >
                            <canvas id="barChartMonths"></canvas>
                        </div>
                    </div>
                    <div class="card" style="width:45%; background:#F9FAFB;">
                        <div class="card-body">
                            <canvas id="doughnutChartBranches"></canvas>
                        </div>
                    </div>       
                </div>       
                <script>
                    var ctx_months = document.getElementById('barChartMonths').getContext('2d');
                    var barChart = new Chart(ctx_months, {
                        type: 'bar',
                        data: {
                            labels: {{ chart_1.labels|safe }},
                            datasets: [{
                                label: 'Cantidad de Trueques',
                                data: {{ chart_1.data }},
                                backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                  'rgba(255, 205, 86, 0.7)',
                                  'rgba(75, 192, 192, 0.7)',
                                  'rgba(54, 162, 235, 0.7)',
                                  'rgba(153, 102, 255, 0.7)',
                                  'rgba(201, 203, 207, 0.7)', 
                                  'rgba(255, 159, 64, 0.7)',                    
                                  "rgba(186, 85, 211, 0.7)",
                                  "rgba(238, 232, 170, 0.7)",
                                  "rgba(144, 238, 144, 0.7)",
                                  "rgba(255, 127, 80, 0.7)",
                                  "rgba(128, 128, 0, 0.7)"],
                                
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    var ctx_branches = document.getElementById('doughnutChartBranches').getContext('2d');
                    var barChart = new Chart(ctx_branches, {
                        type: 'doughnut',
                        data: {
                            labels: {{ chart_4.labels|safe }},
                            datasets: [{
                                label: 'Cantidad de Trueques',
                                data: {{ chart_4.data }},
                                backgroundColor:['rgba(255, 99, 132, 0.7)',
                                  'rgba(255, 205, 86, 0.7)',
                                  'rgba(75, 192, 192, 0.7)',
                                  'rgba(54, 162, 235, 0.7)',
                                  'rgba(153, 102, 255, 0.7)',
                                  'rgba(201, 203, 207, 0.7)', 
                                  'rgba(255, 159, 64, 0.7)',                    
                                  "rgba(186, 85, 211, 0.7)",
                                  "rgba(238, 232, 170, 0.7)",
                                  "rgba(144, 238, 144, 0.7)",
                                  "rgba(255, 127, 80, 0.7)",
                                  "rgba(128, 128, 0, 0.7)"],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                </script>
                {% endif %}
            </div>
        </div>
        <div class="card" style="width: 100%;">
            <div class="card-body" style="display: flex; justify-content:space-evenly">
                <div class="card" style="width: 45%; background:#F9FAFB;">
                    <div class="card-body">
                        <h3>Estado actual de los trueques: </h3>
                        <canvas id="pieChart"></canvas>
                        <script>
                            var ctx = document.getElementById('pieChart').getContext('2d');
                            var barChart = new Chart(ctx, {
                                type: 'pie',
                                data: {
                                    labels: {{ chart_2.labels|safe }},
                                    datasets: [{
                                        label: 'Cantidad de Trueques',
                                        data: {{ chart_2.data }},
                                        backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                            'rgba(255, 205, 86, 0.7)',
                                            'rgba(75, 192, 192, 0.7)',
                                            'rgba(54, 162, 235, 0.7)',
                                            'rgba(153, 102, 255, 0.7)',
                                            'rgba(201, 203, 207, 0.7)', 
                                            'rgba(255, 159, 64, 0.7)',                    
                                            "rgba(186, 85, 211, 0.7)",
                                            "rgba(238, 232, 170, 0.7)",
                                            "rgba(144, 238, 144, 0.7)",
                                            "rgba(255, 127, 80, 0.7)",
                                            "rgba(128, 128, 0, 0.7)"],
                                        borderWidth: 1
                                    }]
                                }
                            });

                        </script>
                    </div>
                </div>
                <div class="card" style="width: 45%; background:#F9FAFB;">
                    <div class="card-body">
                        <h3>Cantidad de trueques por sucursal: </h3>
                        <p>(en cualquier estado)</p>
                        <canvas id="doughnutChart"></canvas>
                        <script>
                            var ctx = document.getElementById('doughnutChart').getContext('2d');
                            var barChart = new Chart(ctx, {
                                type: 'doughnut',
                                data: {
                                    labels: {{ chart_3.labels|safe }},
                                    datasets: [{
                                        label: 'Cantidad de Trueques',
                                        data: {{ chart_3.data }},
                                        backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                            'rgba(255, 205, 86, 0.7)',
                                            'rgba(75, 192, 192, 0.7)',
                                            'rgba(54, 162, 235, 0.7)',
                                            'rgba(153, 102, 255, 0.7)',
                                            'rgba(201, 203, 207, 0.7)', 
                                            'rgba(255, 159, 64, 0.7)',                    
                                            "rgba(186, 85, 211, 0.7)",
                                            "rgba(238, 232, 170, 0.7)",
                                            "rgba(144, 238, 144, 0.7)",
                                            "rgba(255, 127, 80, 0.7)",
                                            "rgba(128, 128, 0, 0.7)"],

                                        borderWidth: 1
                                    }]
                                }
                            });

                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}