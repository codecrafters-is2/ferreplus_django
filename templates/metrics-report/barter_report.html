{% extends "_base_wildcard_bootstrap.html" %}
{% load static %}

{% block title %}Ferreplus{% endblock title %}

{% block custom_styles %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'styles/home/adminpanel.css' %}">
    <link rel="stylesheet" href="{% static 'styles/contact_info/contact_info.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock custom_styles %}
{% block content %}
<div style="width: 95%;">
    <h1 style="margin-bottom:25px; margin-top:25px; font-family: 'Raleway'; ">Reporte de Trueques</h1>
    <div>
        <div class="accordion" id="accordionBarter" style="width:100%;">
            <div class="accordion-item">
                <h3 class="accordion-header" id="heading1">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1" aria-expanded="false" aria-controls="collapse1" style="font-size: 26px">
                        Cantidad de trueques finalizados:
                </button>
                </h3>
                <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#accordionBarter">
                    <div class="accordion-body d-flex flex-wrap" style="padding:3px">
                        <div class="card" style="width: 100%;">
                            <div class="card-body" style="padding: 3px">                     
                                <form method="post" action="{% url 'barter_chart' %}">
                                    {% csrf_token %}
                                    <label for="year" style="font-size:18px; font-weight: 500">Ingresa un año:</label>
                                    <input type="number" id="year" name="year" min="2020" max="2024" value="{{ selected_year|default_if_none:'' }}">
                                    <button type="submit" class="btn btn-outline-primary">Generar Gráficos</button>
                                </form>
                                {% if not chart_1.labels and not chart_1.data %}
                                <p style="color:red; font-weight:bold">ATENCIÓN: Debe ingresar un año para ver la información</p>
                                {% elif chart_2.data|length == 0 %}
                                <p style="color:red; font-weight:bold">No hay información de trueques para el año ingresado</p>
                                {% else %}
                                <div style="display:flex">
                                    <div class="card" style="width:80%; background:#F9FAFB;">
                                        <div class="card-body" >
                                            <h4>Por mes: </h4>
                                            <canvas id="barChartMonths"></canvas>
                                        </div>
                                    </div>
                                    <div class="card" style="width:45%; background:#F9FAFB;">
                                        <div class="card-body">
                                            <h4>Por sucursal: </h4>
                                            <canvas id="doughnutChartBranches"></canvas>
                                        </div>
                                    </div> 
                                    <div class="card" style="width: 45%; background:#F9FAFB;">
                                        <div class="card-body">
                                            <h4>Por categoría: </h4>
                                            <canvas id="doughnutChart6"></canvas>
                                        </div>
                                    </div>    
                                </div>        
                                <script>
                                    var ctx_months = document.getElementById('barChartMonths').getContext('2d');
                                    var barChart = new Chart(ctx_months, {
                                        type: 'bar',
                                        data: {
                                            labels: {{ chart_1.labels|safe }},
                                            datasets: [{
                                                label: 'Cantidad de Trueques',
                                                data: {{ chart_1.data }},
                                                backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                                  'rgba(255, 205, 86, 0.7)',
                                                  'rgba(75, 192, 192, 0.7)',
                                                  'rgba(54, 162, 235, 0.7)',
                                                  'rgba(153, 102, 255, 0.7)',
                                                  'rgba(201, 203, 207, 0.7)', 
                                                  'rgba(255, 159, 64, 0.7)',                    
                                                  "rgba(186, 85, 211, 0.7)",
                                                  "rgba(238, 232, 170, 0.7)",
                                                  "rgba(144, 238, 144, 0.7)",
                                                  "rgba(255, 127, 80, 0.7)",
                                                  "rgba(128, 128, 0, 0.7)"],

                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            scales: {
                                                y: {
                                                    beginAtZero: true
                                                }
                                            }
                                        }
                                    });
                                    var ctx_branches = document.getElementById('doughnutChartBranches').getContext('2d');
                                    var barChart = new Chart(ctx_branches, {
                                        type: 'doughnut',
                                        data: {
                                            labels: {{ chart_4.labels|safe }},
                                            datasets: [{
                                                label: 'Cantidad de Trueques',
                                                data: {{ chart_4.data }},
                                                backgroundColor:['rgba(255, 99, 132, 0.7)',
                                                  'rgba(255, 205, 86, 0.7)',
                                                  'rgba(75, 192, 192, 0.7)',
                                                  'rgba(54, 162, 235, 0.7)',
                                                  'rgba(153, 102, 255, 0.7)',
                                                  'rgba(201, 203, 207, 0.7)', 
                                                  'rgba(255, 159, 64, 0.7)',                    
                                                  "rgba(186, 85, 211, 0.7)",
                                                  "rgba(238, 232, 170, 0.7)",
                                                  "rgba(144, 238, 144, 0.7)",
                                                  "rgba(255, 127, 80, 0.7)",
                                                  "rgba(128, 128, 0, 0.7)"],
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            scales: {
                                                y: {
                                                    beginAtZero: true
                                                }
                                            }
                                        }
                                    });
                                    var ctx = document.getElementById('doughnutChart6').getContext('2d');
                                    var barChart = new Chart(ctx, {
                                        type: 'doughnut',
                                        data: {
                                            labels: {{ chart_6.labels|safe }},
                                            datasets: [{
                                                label: 'Cantidad de Trueques',
                                                data: {{ chart_6.data }},
                                                backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                                    'rgba(255, 205, 86, 0.7)',
                                                    'rgba(75, 192, 192, 0.7)',
                                                    'rgba(54, 162, 235, 0.7)',
                                                    'rgba(153, 102, 255, 0.7)',
                                                    'rgba(201, 203, 207, 0.7)', 
                                                    'rgba(255, 159, 64, 0.7)',                    
                                                    "rgba(186, 85, 211, 0.7)",
                                                    "rgba(238, 232, 170, 0.7)",
                                                    "rgba(144, 238, 144, 0.7)",
                                                    "rgba(255, 127, 80, 0.7)",
                                                    "rgba(128, 128, 0, 0.7)"],
                                            
                                                borderWidth: 1
                                            }]
                                        }
                                    });
                                </script>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h3 class="accordion-header" id="heading2">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2" aria-expanded="false" aria-controls="collapse2" style="font-size: 26px">
                        Información general de cantidad de trueques:
                </button>
                </h3>
                <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#accordionBarter">
                    <div class="accordion-body d-flex flex-wrap" style="padding:3px">
                        {% if chart_2.data|length == 0 %}
                        <p style="color:red; font-weight:bold">No hay información registrada de trueques en el sistema</p>
                        {% endif %}
                        <div class="card" style="width: 100%;">
                            <div class="card-body" style="display: flex; justify-content:space-evenly">
                                {% if chart_2.data|length != 0 %}
                                <div class="card" style="width: 45%; background:#F9FAFB;">
                                    <div class="card-body">
                                        <h3>Estado actual de los trueques: </h3>
                                        <canvas id="pieChart"></canvas>
                                        <script>
                                            var ctx = document.getElementById('pieChart').getContext('2d');
                                            var barChart = new Chart(ctx, {
                                                type: 'pie',
                                                data: {
                                                    labels: {{ chart_2.labels|safe }},
                                                    datasets: [{
                                                        label: 'Cantidad de Trueques',
                                                        data: {{ chart_2.data }},
                                                        backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                                            'rgba(255, 205, 86, 0.7)',
                                                            'rgba(75, 192, 192, 0.7)',
                                                            'rgba(54, 162, 235, 0.7)',
                                                            'rgba(153, 102, 255, 0.7)',
                                                            'rgba(201, 203, 207, 0.7)', 
                                                            'rgba(255, 159, 64, 0.7)',                    
                                                            "rgba(186, 85, 211, 0.7)",
                                                            "rgba(238, 232, 170, 0.7)",
                                                            "rgba(144, 238, 144, 0.7)",
                                                            "rgba(255, 127, 80, 0.7)",
                                                            "rgba(128, 128, 0, 0.7)"],
                                                        borderWidth: 1
                                                    }]
                                                }
                                            });
                                        
                                        </script>
                                    </div>
                                </div>
                                <div class="card" style="width: 45%; background:#F9FAFB;">
                                    <div class="card-body">
                                        <h3>Cantidad de trueques por sucursal: </h3>
                                        <p>(en cualquier estado)</p>
                                        <canvas id="doughnutChart"></canvas>
                                        <script>
                                            var ctx = document.getElementById('doughnutChart').getContext('2d');
                                            var barChart = new Chart(ctx, {
                                                type: 'doughnut',
                                                data: {
                                                    labels: {{ chart_3.labels|safe }},
                                                    datasets: [{
                                                        label: 'Cantidad de Trueques',
                                                        data: {{ chart_3.data }},
                                                        backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                                            'rgba(255, 205, 86, 0.7)',
                                                            'rgba(75, 192, 192, 0.7)',
                                                            'rgba(54, 162, 235, 0.7)',
                                                            'rgba(153, 102, 255, 0.7)',
                                                            'rgba(201, 203, 207, 0.7)', 
                                                            'rgba(255, 159, 64, 0.7)',                    
                                                            "rgba(186, 85, 211, 0.7)",
                                                            "rgba(238, 232, 170, 0.7)",
                                                            "rgba(144, 238, 144, 0.7)",
                                                            "rgba(255, 127, 80, 0.7)",
                                                            "rgba(128, 128, 0, 0.7)"],
                                                    
                                                        borderWidth: 1
                                                    }]
                                                }
                                            });
                                        
                                        </script>
                                    </div>
                                </div>
                                <div class="card" style="width: 45%; background:#F9FAFB;">
                                    <div class="card-body">
                                        <h3>Cantidad de trueques por categoría: </h3>
                                        <p>(en cualquier estado)</p>
                                        <canvas id="doughnutChart2"></canvas>
                                        <script>
                                            var ctx = document.getElementById('doughnutChart2').getContext('2d');
                                            var barChart = new Chart(ctx, {
                                                type: 'doughnut',
                                                data: {
                                                    labels: {{ chart_5.labels|safe }},
                                                    datasets: [{
                                                        label: 'Cantidad de Trueques',
                                                        data: {{ chart_5.data }},
                                                        backgroundColor: ['rgba(255, 99, 132, 0.7)',
                                                            'rgba(255, 205, 86, 0.7)',
                                                            'rgba(75, 192, 192, 0.7)',
                                                            'rgba(54, 162, 235, 0.7)',
                                                            'rgba(153, 102, 255, 0.7)',
                                                            'rgba(201, 203, 207, 0.7)', 
                                                            'rgba(255, 159, 64, 0.7)',                    
                                                            "rgba(186, 85, 211, 0.7)",
                                                            "rgba(238, 232, 170, 0.7)",
                                                            "rgba(144, 238, 144, 0.7)",
                                                            "rgba(255, 127, 80, 0.7)",
                                                            "rgba(128, 128, 0, 0.7)"],
                                                    
                                                        borderWidth: 1
                                                    }]
                                                }
                                            });
                                        
                                        </script>
                                    </div>
                                </div> 
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="width: 54%;">
        <div class="mt-4 d-flex justify-content-start">
            <a href="{% url 'metrics' %}" class="btn btn-light">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>
                </svg>
                Volver
            </a>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
{% endblock content %}